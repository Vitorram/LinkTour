<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Perfil</title>
<style>
  body { margin: 0; font-family: Arial, sans-serif; background-color: #f9f9f9; }

  .banner { width: 100%; height: 180px; background: #ccc; background-size: cover; background-position: center; position: relative; }

  .perfil-foto { width: 100px; height: 100px; border-radius: 50%; border: 3px solid #fff; position: absolute; bottom: -50px; left: 50%; transform: translateX(-50%); overflow: hidden; }
  .perfil-foto img { width: 100%; height: 100%; object-fit: cover; }

  .perfil-info { text-align: center; margin-top: 60px; padding: 10px; }
  .perfil-info h2 { margin: 5px 0; font-size: 18px; }
  .perfil-info p { margin: 5px 0; color: #666; font-size: 14px; }

  #editar-perfil { margin-top: 10px; padding: 8px 20px; border: none; border-radius: 8px; background-color: #e60050; color: white; font-weight: bold; cursor: pointer; transition: 0.3s; }
  #editar-perfil:hover { background-color: #cc0045; }

  .stats { display: flex; justify-content: center; gap: 40px; margin: 15px 0; }
  .stats div { text-align: center; }
  .stats strong { display: block; font-size: 16px; }

  .abas { display: flex; justify-content: center; gap: 15px; border-top: 1px solid #ddd; border-bottom: 1px solid #ddd; padding: 10px 0; background: #fff; margin-bottom: 10px; }
  .abas img{ width: 30px; height: 30px; }

  .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; padding: 10px; }
  .grid img { width: 100%; border-radius: 8px; height: 160px; object-fit: cover; }

  .barraInferior { position: fixed; bottom: 0; width: 100%; display: flex; justify-content: space-around; background-color: #fff; padding: 10px 0; border-top: 1px solid #ddd; z-index: 200; }
  .barraInferior img{ width: 30px; height: 30px; }

  #modalEditar { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1000; }
  #modalEditar .conteudo { background: #fff; padding: 20px; border-radius: 12px; width: 90%; max-width: 400px; box-sizing: border-box; }

  #modalEditar label { display:block; margin-top: 10px; font-weight:bold; }
  #modalEditar input, #modalEditar textarea { width:100%; padding:8px; margin-top:5px; border-radius:6px; border:1px solid #ccc; box-sizing: border-box; }
  #modalEditar button { margin-top:15px; padding: 10px; border:none; border-radius:8px; background:#e60050; color:white; cursor:pointer; width:100%; }
  #modalEditar button:hover { background:#cc0045; }

  .preview-img { margin-top: 5px; width: 100%; max-height: 150px; object-fit: cover; border-radius: 8px; }
  .preview-foto { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin-top:5px; }
</style>
</head>
<body>

  <!-- Banner e foto -->
  <div class="banner" id="perfil-banner">
    <div class="perfil-foto">
      <img id="perfil-foto" src="https://via.placeholder.com/100" alt="Foto de Perfil">
    </div>
  </div>

  <!-- Info perfil -->
  <div class="perfil-info">
    <h2 id="perfil-nome">Usuário</h2>
    <p id="perfil-arroba">@usuario</p>
    <p id="perfil-desc">Descrição do perfil</p>
    <button id="editar-perfil">Editar Perfil</button>
  </div>

  <!-- Stats -->
  <div class="stats">
    <div><strong>0</strong> Seguindo</div>
    <div><strong>0</strong> Seguidores</div>
  </div>

  <!-- Abas -->
  <div class="abas" style="gap: 60px;">
    <div><img src="/img/icons8-fotos-50.png" alt=""></div>
    <div><img src="/img/icons8-mais-30.png" alt=""></div>
  </div>

  <!-- Grid de posts -->
  <div class="grid" id="gridPosts"></div>

  <!-- Rodapé -->
  <div class="barraInferior">
    <a href="/HTML/home.HTML"><img src="/img/icons8-casa-48.png" alt=""></a>
    <a href="/HTML/mapa.html"><img src="/img/icons8-mapa-50.png" alt=""></a>
    <a href="/HTML/add.html"><img src="/img/icons8-mais-50.png" alt=""></a>
    <a href="/HTML/serv.html"><img src="/img/icons8-parceiro-50.png" alt=""></a>
    <a href="/HTML/perfil.html"><img src="/img/icons8-conta-de-teste-50.png" alt=""></a>
  </div>

  <!-- Modal de edição -->
  <div id="modalEditar">
    <div class="conteudo">
      <h3>Editar Perfil</h3>

      <label>Nome</label>
      <input type="text" id="editar-nome">

      <label>@username</label>
      <input type="text" id="editar-arroba">

      <label>Descrição</label>
      <textarea id="editar-desc"></textarea>

      <label>Foto de Perfil</label>
      <input type="file" id="editar-foto-file" accept="image/*">
      <img id="preview-foto" class="preview-foto" src="https://via.placeholder.com/100">

      <label>Banner</label>
      <input type="file" id="editar-banner-file" accept="image/*">
      <img id="preview-banner" class="preview-img" src="https://via.placeholder.com/300x100?text=Banner">

      <button id="salvar-edicao">Salvar</button>
      <button id="fechar-edicao" style="background:#ccc; color:#000; margin-top:5px;">Cancelar</button>
    </div>
  </div>

<!-- Lib heic2any -->
<script src="https://cdn.jsdelivr.net/npm/heic2any/dist/heic2any.min.js"></script>

<script>
  // Carregar dados do localStorage
  window.addEventListener("DOMContentLoaded", () => {
    const usuario = localStorage.getItem("usuario") || "Usuário";
    const arroba = localStorage.getItem("arroba") || "@usuario";
    const descricao = localStorage.getItem("descricao") || "Sem descrição";
    const foto = localStorage.getItem("foto") || "https://via.placeholder.com/100";
    const banner = localStorage.getItem("banner") || "https://via.placeholder.com/300x100?text=Banner";

    document.getElementById("perfil-nome").textContent = usuario;
    document.getElementById("perfil-arroba").textContent = arroba;
    document.getElementById("perfil-desc").textContent = descricao;
    document.getElementById("perfil-foto").src = foto;
    document.getElementById("perfil-banner").style.backgroundImage = `url(${banner})`;
  });

  const btnEditar = document.getElementById("editar-perfil");
  const modal = document.getElementById("modalEditar");
  const btnFechar = document.getElementById("fechar-edicao");
  const btnSalvar = document.getElementById("salvar-edicao");

  const inputFotoFile = document.getElementById("editar-foto-file");
  const inputBannerFile = document.getElementById("editar-banner-file");
  const previewFoto = document.getElementById("preview-foto");
  const previewBanner = document.getElementById("preview-banner");

  btnEditar.addEventListener("click", () => {
    modal.style.display = "flex";
    document.getElementById("editar-nome").value = localStorage.getItem("usuario") || "";
    document.getElementById("editar-arroba").value = localStorage.getItem("arroba") || "";
    document.getElementById("editar-desc").value = localStorage.getItem("descricao") || "";
    previewFoto.src = localStorage.getItem("foto") || "https://via.placeholder.com/100";
    previewBanner.src = localStorage.getItem("banner") || "https://via.placeholder.com/300x100?text=Banner";
  });

  btnFechar.addEventListener("click", () => modal.style.display = "none");

  // Função para tratar upload e conversão
  async function handleImageUpload(file, previewElement){
    if(!file) return;

    const validTypes = ["image/jpeg", "image/png", "image/gif", "image/webp"];
    if(validTypes.includes(file.type)){
      const reader = new FileReader();
      reader.onload = e => previewElement.src = e.target.result;
      reader.readAsDataURL(file);
    } else if(file.type === "image/heic" || file.name.endsWith(".heic")){
      try {
        const convertedBlob = await heic2any({ blob: file, toType: "image/jpeg" });
        previewElement.src = URL.createObjectURL(convertedBlob);
      } catch(err){
        alert("Erro ao converter imagem HEIC.");
      }
    } else {
      alert("Formato não suportado. Use JPG, PNG, GIF ou WEBP.");
    }
  }

  inputFotoFile.addEventListener("change", async () => {
    await handleImageUpload(inputFotoFile.files[0], previewFoto);
  });

  inputBannerFile.addEventListener("change", async () => {
    await handleImageUpload(inputBannerFile.files[0], previewBanner);
  });

  btnSalvar.addEventListener("click", () => {
    const nome = document.getElementById("editar-nome").value;
    const arroba = document.getElementById("editar-arroba").value;
    const desc = document.getElementById("editar-desc").value;
    const fotoSrc = previewFoto.src;
    const bannerSrc = previewBanner.src;

    localStorage.setItem("usuario", nome);
    localStorage.setItem("arroba", arroba);
    localStorage.setItem("descricao", desc);
    localStorage.setItem("foto", fotoSrc);
    localStorage.setItem("banner", bannerSrc);

    document.getElementById("perfil-nome").textContent = nome;
    document.getElementById("perfil-arroba").textContent = arroba;
    document.getElementById("perfil-desc").textContent = desc;
    document.getElementById("perfil-foto").src = fotoSrc;
    document.getElementById("perfil-banner").style.backgroundImage = `url(${bannerSrc})`;

    modal.style.display = "none";
  });
</script>
</body>
</html>
